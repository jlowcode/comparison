define(["jquery","fab/list-plugin"],function(e,t){return new Class({Extends:t,initialize:function(e){this.parent(e)},createModal:function(){var e=document.createElement("div");e.setAttribute("class","comparison-modal"),e.setAttribute("id","comparisonModal");var t=document.createElement("div");t.setAttribute("class","comparison-modal-content");var n=document.createElement("div");n.setAttribute("class","comparison-modal-header");var o=document.createElement("span");o.setAttribute("class","comparison-modal-close"),o.innerHTML="&times;";var a=document.createElement("h2");a.innerHTML="Comparações",n.appendChild(o),n.appendChild(a);var i=document.createElement("div");i.setAttribute("class","comparison-modal-body");var s=document.createElement("div");s.setAttribute("id","comparison_autocomplete");var l=document.createElement("input");l.setAttribute("type","text"),l.setAttribute("id","input_comparison_autocomplete"),l.setAttribute("placeholder","Adicionar"),s.appendChild(l);var d=document.createElement("div");d.setAttribute("id","div_table_comparison"),d.setAttribute("class","table-responsive"),d.setAttribute("style","overflow: auto"),i.appendChild(s),i.appendChild(d);var c=document.createElement("div");c.setAttribute("class","comparison-modal-footer"),t.appendChild(n),t.appendChild(i),t.appendChild(c),e.appendChild(t);var r=document.getElement("body"),m=document.getElement("head"),u=document.createElement("link");u.setAttribute("href",this.options.url+"plugins/fabrik_list/comparison/modal/modal.css"),u.setAttribute("rel","stylesheet"),r.appendChild(e),m.appendChild(u)},autocomplete:function(e,t){var n,o=this;function a(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("comparison_autocomplete-active")}(e),n>=e.length&&(n=0),n<0&&(n=e.length-1),e[n].classList.add("comparison_autocomplete-active")}function i(t){for(var n=document.getElementsByClassName("comparison_autocomplete-items"),o=0;o<n.length;o++)t!=n[o]&&t!=e&&n[o].parentNode.removeChild(n[o])}e.addEventListener("input",function(a){var s,l,d,c=this.value,r=o.options.main_column.name;if(i(),!c)return!1;for(n=-1,(s=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),s.setAttribute("class","comparison_autocomplete-items"),this.parentNode.appendChild(s),d=0;d<t.length;d++)t[d][r].substr(0,c.length).toUpperCase()==c.toUpperCase()&&((l=document.createElement("DIV")).innerHTML="<strong>"+t[d][r].substr(0,c.length)+"</strong>",l.innerHTML+=t[d][r].substr(c.length),l.innerHTML+="<input type='hidden' value='"+t[d][r]+"'>",l.innerHTML+="<input type='hidden' name='id_value' value='"+t[d].id+"'>",l.addEventListener("click",function(t){e.value=this.getElementsByTagName("input")[0].value;var n=this.getElementsByTagName("input")[1].value;o.addColumn(n),i()}),s.appendChild(l))}),e.addEventListener("keydown",function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(n++,a(t)):38==e.keyCode?(n--,a(t)):13==e.keyCode&&(e.preventDefault(),n>-1&&t&&t[n].click())}),document.addEventListener("click",function(e){i(e.target)})},watchButton:function(){"null"!==typeOf(this.options.name)&&(this.createModal(),this.insertLightBox(),document.addEvent("click:relay(input[name^=checkAll])",(e,t)=>{var n=!0;document.getElements("input[name^=ids]").each(function(e){e.checked||(n=!1)});e.target.getParent().getElement("input[name^=checkAll]");n?(t.set("checked",!1),document.getElements("input[name=checkAll]").set("checked",!1),document.getElements("input[name^=ids]").set("checked",!1)):(t.set("checked",!0),document.getElements("input[name^=ids]").set("checked",!0))}),document.addEvent("click:relay(."+this.options.name+")",t=>{if(!t.rightClick){t.stop(),t.preventDefault();var n,o,a=[];t.target.getParent(".fabrik_row")&&(n=t.target.getParent(".fabrik_row")).getElement("input[name^=ids]")&&(o=n.getElement("input[name^=ids]"),document.getElements("input[name^=ids]").set("checked",!1),o.set("checked",!0),e("input[name^=checkAll]").prop("checked",!1));var i=!1;document.getElements("input[name^=ids]").each(function(e){e.checked&&(i=!0,a.push(e.value))}),i?this.buttonAction(a):alert(Joomla.JText._("COM_FABRIK_PLEASE_SELECT_A_ROW"))}}))},createTable:function(){var e=this.options.columns,t=document.getElementById("div_table_comparison"),n=document.createElement("table");n.setAttribute("class","table"),n.setAttribute("id","table_comparison");var o=document.createElement("thead"),a=document.createElement("tr");a.setAttribute("id","tr_delete");var i=document.createElement("th");i.setAttribute("scope","col"),i.innerHTML="#",a.appendChild(i),o.appendChild(a),n.appendChild(o);var s,l,d=document.createElement("tbody"),c=0;for(c=0;c<e.length;c++)(s=document.createElement("tr")).setAttribute("id",e[c].name),(l=document.createElement("th")).setAttribute("scope","row"),l.innerHTML=e[c].label,s.appendChild(l),d.appendChild(s);n.appendChild(d),t.appendChild(n)},getIndex:function(e,t){var n,o;for(n=0;n<e.length;n++)e[n].id==t&&(o=n);return o},addColumn:function(t){var n,o,a=this.options.columns,i=this.getIndex(this.options.data_autocomplete,t),s=this.options.data_autocomplete[i],l=0;for(l=0;l<a.length;l++)n=document.getElementById(a[l].name),(o=document.createElement("td")).setAttribute("class","row_"+t),o.innerHTML=s[a[l].name],n.appendChild(o);var d=document.getElementById("tr_delete"),c=document.createElement("td");c.setAttribute("class","row_"+t);var r=this,m=document.createElement("a");m.setAttribute("style","cursor: pointer"),m.onclick=function(){e(".row_"+t).remove(),r.options.data_autocomplete.push(s),i=r.getIndex(r.options.data_used,t),r.options.data_used.splice(i,1),r.autocomplete(document.getElementById("input_comparison_autocomplete"),r.options.data_autocomplete)},m.innerHTML="x",c.appendChild(m),d.appendChild(c),this.options.data_used.push(s),i=this.getIndex(this.options.data_autocomplete,t),this.options.data_autocomplete.splice(i,1),this.autocomplete(document.getElementById("input_comparison_autocomplete"),this.options.data_autocomplete)},openModal:function(){var e=document.getElementById("comparisonModal"),t=document.getElement("body");t.style.overflowY="hidden",e.style.display="block",document.getElementsByClassName("comparison-modal-close")[0].onclick=function(){e.style.display="none",t.style.overflowY="auto"},window.onclick=function(n){n.target==e&&(e.style.display="none",t.style.overflowY="auto")}},buttonAction:function(t){var n;if(e("#comparisonModal").length?(e("#table_comparison").remove(),e("#input_autocomplete").remove()):this.createModal(),this.createTable(),this.openModal(),this.options.data_used&&this.options.data_autocomplete)for(n=0;n<this.options.data_used.length;n++)this.options.data_autocomplete.push(this.options.data_used[n]);for(this.options.data_autocomplete=this.options.data,this.options.data_used=[],n=0;n<t.length;n++)this.addColumn(t[n])},insertLightBox:function(){for(var e,t,n=!1,o=!1,a=document.getElementsByTagName("head")[0],i=document.getElementsByTagName("link"),s=document.getElementsByTagName("script"),l=this.options.url+"plugins/fabrik_list/comparison/lib/lightbox/css/lightbox.css",d=this.options.url+"plugins/fabrik_list/comparison/lib/lightbox/js/lightbox.js",c=0;c<i.length;c++)i[c].getAttribute("href")===l&&(n=!0);for(c=0;c<s.length;c++)s[c].getAttribute("src")===d&&(o=!0);n||((e=document.createElement("link")).setAttribute("href",l),e.setAttribute("rel","stylesheet"),a.appendChild(e)),o||((t=document.createElement("script")).setAttribute("src",d),a.appendChild(t))}})});